@testset "performance" verbose=true begin
    ac = load_default_model()
    size_aircraft!(ac; printiter=false);
    FL = float([  0 ,    5 ,   10 ,   15 ,   20 ,   
            30 ,   40 ,   60 ,   80 ,  100 , 
            120 ,  140 ,  160 ,  180 ,  200 ,
            220 ,  240 ,  260 ,  280 ,  290 , 
            310 ,  330 ,  350 ,  370 ,  390 ,
            410])

    parg = ac.parg
    ZFW = parg[igWMTO] - parg[igWfuel]
    OEW = parg[igWMTO] - parg[igWfuel] - parg[igWpay]
            
    M_high = 0.92 * parg[igWMTO]
    M_low = 0.45 * parg[igWMTO] +(0.63 * (parg[igWMTO]^0.924))
    W = [parg[igWMTO], 1/3*(OEW+2*parg[igWMTO]), 1.2*OEW]
    Wpaymax = parg[igWpaymax]
    Ldebug = false

    @testset "off design performance" begin
        high_outputs_correct = (885454.0322298721, 12496.800000000001, [80.81275720164649, 81.39379412431006, 81.98161188263717, 85.20233995064308, 85.82234928001363, 97.80729092781559, 115.54249464124159, 140.08552139650615, 144.25638080841546, 177.77537021190292, 183.0601797378208, 188.5521173101196, 194.25360270400643, 200.1661063467623, 206.2900340467326, 212.62461202148936, 219.16777682424814, 225.91608887758503, 232.86479312886004, 236.41264441866187, 241.43705872286955, 239.359920983201, 237.4846310775805, 236.35362144223177, 236.03584679797737, 235.983685523832], [144.08971775773998, 145.12857265635765, 151.24951930762006, 162.5587648643785, 194.5760978175237, 229.58504471848303, 232.9307613515055, 272.30682178000575, 280.4143939204095, 334.27036197570885, 344.26328208608953, 354.6533091966123, 365.4458194048345, 376.6444562446586, 388.25090879628647, 400.2646880695055, 412.68291006191595, 425.5001205402086, 438.70839420244005, 445.45639573697844, 459.2388851020328, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [2392.544630194291, 2403.7596316144864, 2415.0326679475006, 2524.707363481259, 2658.424110543945, 3045.9896260852543, 3141.3401240955404, 3943.902023435176, 4006.915992766854, 4283.930561357283, 4323.248706416482, 4353.573815344715, 4368.889967603582, 4356.542873140332, 4277.713475133699, 3372.1422105544266, 3412.768219746332, 3453.430794363311, 3494.3854007216155, 3515.6503966549562, 3558.763590159204, 3607.2290054925647, 3634.399971315634, 3622.418656043852, 3514.7023304145996, 3007.568246499911], [1.3617074872569908, 1.36162508611689, 1.3615408294678377, 1.3611410802870587, 1.3610472861212992, 1.3594224754034578, 1.3566040242635569, 1.3517266277175453, 1.350584138002611, 1.3413969777380126, 1.3392367551006958, 1.3367685965891274, 1.333885636391117, 1.330371396421806, 1.3255689665508776, 1.3065429693906012, 1.303930745141643, 1.301115668881096, 1.2980853205770384, 1.2964854886281403, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0752930675545194, 1.0814205122154963, 1.0882888867601341, 1.0948320352847851, 1.1400265198009463, 1.1462654889977, 1.1524843348564298, 1.1587628223439213, 1.166764848197707, 1.1724666372953987, 1.1780710286835108, 1.183461484420854, 1.1860333284488265, 1.1913789991187667, 1.204197487376951, 1.1961859040780904, 1.2025821635173024, 1.243061152391704, 1.3853449486055913], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 272.30682178000575, 280.4143939204095, 288.8726703929836, 297.6912462923113, 342.7558745030535, 353.25127374797063, 364.14805983243093, 375.44878601788986, 387.15394727893124, 399.2617620445512, 411.7679915944973, 424.6660222141039, 431.2595993728225, 444.7353321785322, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3517266277175453, 1.350584138002611, 1.3493277302425493, 1.347943014853711, 1.3410149019457325, 1.3387377414104185, 1.3361200135226603, 1.333030103750058, 1.3291761694017405, 1.3233867147351581, 1.3056995893861636, 1.3029673119424714, 1.301522601163575, 1.298468268143078, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3932.184954612472, 3995.436963691259, 4055.436700551645, 4116.214948934847, 4360.3463652139335, 4401.947350675514, 4432.870685605248, 4445.269601134204, 4415.251940298619, 4291.273798086553, 3480.704414808981, 3523.3381721386477, 3545.11941902715, 3587.552169711718, 3629.852333333113, 3640.254152261392, 3591.1834608448985, 3386.7278377279904, 2670.727594450769], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1613.3042600505478, 1613.44614659403, 1613.601897884832, 1613.7732025012099, 1614.6242904953642, 1614.9016172995189, 1615.218746684757, 1615.5905198332864, 1616.0497008230107, 1616.7272851904318, 1618.729477873772, 1619.0724919434354, 1619.253752189646, 1619.6367198234059, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 21.173059800837475, 21.733294839166277, 22.37596970327484, 23.045780683994227, 27.553716647272598, 28.524735132295255, 29.57058145275192, 30.704735258094633, 32.074085541363054, 33.35557661820079, 34.73475740131493, 36.216391960743294, 36.99697344404012, 38.68905545978498, 41.840530469163674, 41.00895983317384, 41.67178095191293, 46.065089928526554, 64.13869448636662], [35.39012349429648, 35.4119700670855, 35.43431346501934, 35.54038606286128, 35.5652896695099, 35.99757625254033, 36.75076414853945, 38.059858537916625, 38.366679986820756, 40.809808916229315, 41.37077127177199, 42.000748309561644, 42.71736217161768, 43.553327163668314, 44.599855004437615, 47.49352902883152, 48.410746888573996, 49.4164674757167, 50.51943981160886, 51.11036091241492, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01776098991116836, 0.017862199047624858, 0.017975646380890824, 0.01808372184277202, 0.018830214875929507, 0.018933266101965624, 0.019035984943822578, 0.01913968890722331, 0.01927186115379161, 0.019366039589136703, 0.019458609272608087, 0.01954764530646376, 0.019590125349544296, 0.019678421652851785, 0.019890149085585836, 0.01975781897537025, 0.019863468219094495, 0.020532073769251723, 0.02288222476094819], 12496.800000000001)

        nom_outputs_correct = (748246.8497553836, 12496.800000000001, [80.81275720164649, 81.39379412431006, 81.98161188263717, 85.20233995064308, 85.82234928001363, 97.80729092781559, 115.54249464124159, 140.08552139650615, 144.25638080841546, 177.77537021190292, 183.0601797378208, 188.5521173101196, 194.25360270400643, 200.1661063467623, 206.2900340467326, 212.62461202148936, 219.16777682424814, 225.91608887758503, 232.86479312886004, 236.41264441866187, 241.43705872286955, 239.359920983201, 237.4846310775805, 236.35362144223177, 236.03584679797737, 235.983685523832], [144.08971775773998, 145.12857265635765, 151.24951930762006, 162.5587648643785, 194.5760978175237, 229.58504471848303, 232.9307613515055, 272.30682178000575, 280.4143939204095, 334.27036197570885, 344.26328208608953, 354.6533091966123, 365.4458194048345, 376.6444562446586, 388.25090879628647, 400.2646880695055, 412.68291006191595, 425.5001205402086, 438.70839420244005, 445.45639573697844, 459.2388851020328, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [3148.188632417325, 3163.8671096047115, 3179.6446436099213, 3300.361972029556, 3430.486486347392, 3857.7078170805776, 4343.336538961069, 4858.398328482374, 4939.720438948465, 5228.732344875856, 5282.04682067557, 5324.977346851019, 5350.399664247522, 5343.540122282238, 5258.929742365601, 4201.261049435578, 4258.515491757201, 4316.703543329386, 4376.744108427927, 4406.085911669323, 4476.037739439065, 4563.6490495844655, 4630.625758631863, 4687.256890627939, 4734.145806099512, 4733.375201347953], [1.3617074872569908, 1.36162508611689, 1.3615408294678377, 1.3611410802870587, 1.3610472861212992, 1.3594224754034578, 1.3566040242635569, 1.3517266277175453, 1.350584138002611, 1.3413969777380126, 1.3392367551006958, 1.3367685965891274, 1.333885636391117, 1.330371396421806, 1.3255689665508776, 1.3065429693906012, 1.303930745141643, 1.301115668881096, 1.2980853205770384, 1.2964854886281403, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0137697532278784, 1.0195160427261418, 1.0259815383245867, 1.032083058696482, 1.0902861450218109, 1.0961070392396863, 1.1018818665726617, 1.1076661715400666, 1.1151435977116229, 1.1201557460509948, 1.124917131063436, 1.1295423801910307, 1.1318420658565593, 1.1362856655854516, 1.1487063949693868, 1.1326847003572051, 1.1207503837702613, 1.1155143222619466, 1.125198718581149], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 272.30682178000575, 280.4143939204095, 288.8726703929836, 297.6912462923113, 342.7558745030535, 353.25127374797063, 364.14805983243093, 375.44878601788986, 387.15394727893124, 399.2617620445512, 411.7679915944973, 424.6660222141039, 431.2595993728225, 444.7353321785322, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3517266277175453, 1.350584138002611, 1.3493277302425493, 1.347943014853711, 1.3410149019457325, 1.3387377414104185, 1.3361200135226603, 1.333030103750058, 1.3291761694017405, 1.3233867147351581, 1.3056995893861636, 1.3029673119424714, 1.301522601163575, 1.298468268143078, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4856.291718558492, 4938.334766401703, 5016.666157355598, 5096.34423139732, 5366.817410893567, 5423.886942349124, 5468.855351261128, 5492.61402125751, 5467.119776587893, 5331.776661248361, 4387.357717969589, 4449.9581267262265, 4481.481159092711, 4545.595797959026, 4613.039914121897, 4666.575740156144, 4710.1137311074135, 4732.015086679245, 4676.561618809898], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1613.3042600505478, 1613.44614659403, 1613.601897884832, 1613.7732025012099, 1614.6242904953642, 1614.9016172995189, 1615.218746684757, 1615.5905198332864, 1616.0497008230107, 1616.7272851904318, 1618.729477873772, 1619.0724919434354, 1619.253752189646, 1619.6367198234059, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 18.14049406665222, 18.581641704635963, 19.090127617362707, 19.620027116549146, 24.18231858123592, 25.00622607742476, 25.895205603566403, 26.85953182265779, 28.02967008567576, 29.111861414517318, 30.268551460029443, 31.5161155325091, 32.18218327876675, 33.60011131228459, 36.357870636617506, 34.895030429880606, 33.84025121453725, 33.386856455175014, 34.22992821698059], [35.39012349429648, 35.4119700670855, 35.43431346501934, 35.54038606286128, 35.5652896695099, 35.99757625254033, 36.75076414853945, 38.059858537916625, 38.366679986820756, 40.809808916229315, 41.37077127177199, 42.000748309561644, 42.71736217161768, 43.553327163668314, 44.599855004437615, 47.49352902883152, 48.410746888573996, 49.4164674757167, 50.51943981160886, 51.11036091241492, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.016744787911891816, 0.016839701375843945, 0.01694649421731166, 0.017047275153261036, 0.018008635790853555, 0.018104781526929754, 0.01820016636023197, 0.018295707738921262, 0.018419214989922657, 0.018502002388795524, 0.01858064784250563, 0.018657044692416212, 0.01869502940108471, 0.018768425884643943, 0.01897358339559036, 0.018708947488456747, 0.018511824227000723, 0.018425338376371246, 0.01858529892155758], 12496.800000000001)

        low_outputs_correct = (568598.9817676877, 12496.800000000001, [80.81275720164649, 81.39379412431006, 81.98161188263717, 85.20233995064308, 85.82234928001363, 97.80729092781559, 115.54249464124159, 140.08552139650615, 144.25638080841546, 177.77537021190292, 183.0601797378208, 188.5521173101196, 194.25360270400643, 200.1661063467623, 206.2900340467326, 212.62461202148936, 219.16777682424814, 225.91608887758503, 232.86479312886004, 236.41264441866187, 241.43705872286955, 239.359920983201, 237.4846310775805, 236.35362144223177, 236.03584679797737, 235.983685523832], [144.08971775773998, 145.12857265635765, 151.24951930762006, 162.5587648643785, 194.5760978175237, 229.58504471848303, 232.9307613515055, 272.30682178000575, 280.4143939204095, 334.27036197570885, 344.26328208608953, 354.6533091966123, 365.4458194048345, 376.6444562446586, 388.25090879628647, 400.2646880695055, 412.68291006191595, 425.5001205402086, 438.70839420244005, 445.45639573697844, 459.2388851020328, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [3991.085377421062, 4005.8339013509467, 4020.521959319276, 4500.6772226102685, 4586.281648533435, 5384.091290042248, 6014.478637538772, 6636.862953858549, 6752.699879406706, 6529.457755449276, 6624.2703720737045, 6709.5674385263555, 6776.791973754366, 6807.693429829525, 6745.853114651152, 5481.832608855845, 5595.752893851853, 5714.574215192313, 5833.4457530296995, 5894.630828069086, 6075.706675446547, 6343.423400396119, 6505.048719162258, 6631.279082348742, 6755.151804816986, 6863.134273158005], [1.3617074872569908, 1.36162508611689, 1.3615408294678377, 1.3611410802870587, 1.3610472861212992, 1.3594224754034578, 1.3566040242635569, 1.3517266277175453, 1.350584138002611, 1.3413969777380126, 1.3392367551006958, 1.3367685965891274, 1.333885636391117, 1.330371396421806, 1.3255689665508776, 1.3065429693906012, 1.303930745141643, 1.301115668881096, 1.2980853205770384, 1.2964854886281403, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.9467568690846793, 0.9521011818770683, 0.9581314004593746, 0.9637423714291246, 1.0386886247545268, 1.0436413917926106, 1.0485375962508312, 1.053433133501285, 1.06006166954258, 1.064135408552077, 1.067957392895738, 1.0716123999940725, 1.0734095998839868, 1.0768038960825954, 1.0903842680724432, 1.0669858694879564, 1.046998754092211, 1.030445535170286, 1.017280635925379], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 272.30682178000575, 280.4143939204095, 288.8726703929836, 297.6912462923113, 342.7558745030535, 353.25127374797063, 364.14805983243093, 375.44878601788986, 387.15394727893124, 399.2617620445512, 411.7679915944973, 424.6660222141039, 431.2595993728225, 444.7353321785322, 465.2824838332964, 461.63718038562416, 459.4386545413105, 458.82094471265333, 458.7195504312106], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335, 0.0033333333333333335], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.3517266277175453, 1.350584138002611, 1.3493277302425493, 1.347943014853711, 1.3410149019457325, 1.3387377414104185, 1.3361200135226603, 1.333030103750058, 1.3291761694017405, 1.3233867147351581, 1.3056995893861636, 1.3029673119424714, 1.301522601163575, 1.298468268143078, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096, 1.2939257334297096], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6650.137908314231, 6768.133883395193, 6881.144496410339, 6996.551045422574, 7319.9805715745215, 7407.877542322377, 7480.711863614287, 7526.646918446, 7509.155809775852, 7349.1007138062405, 6132.209907461781, 6231.825061848493, 6282.414285995054, 6386.124974973122, 6487.729722955662, 6602.260021255565, 6709.112977908067, 6812.742507575736, 6899.620458367555], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1613.3042600505478, 1613.44614659403, 1613.601897884832, 1613.7732025012099, 1614.6242904953642, 1614.9016172995189, 1615.218746684757, 1615.5905198332864, 1616.0497008230107, 1616.7272851904318, 1618.729477873772, 1619.0724919434354, 1619.253752189646, 1619.6367198234059, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635, 1620.205700158635], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 15.502642201774952, 15.834545645272094, 16.21863924128056, 16.61832889167786, 21.161545699988128, 21.82373920215225, 22.540686795416647, 23.32130764894052, 24.280838011894605, 25.159296330895234, 26.101401788318267, 27.118999273113374, 27.66063026912072, 28.807983402906107, 31.290048665321457, 29.45430376805341, 27.97342526961009, 26.80642195434469, 25.915950467916876], [35.39012349429648, 35.4119700670855, 35.43431346501934, 35.54038606286128, 35.5652896695099, 35.99757625254033, 36.75076414853945, 38.059858537916625, 38.366679986820756, 40.809808916229315, 41.37077127177199, 42.000748309561644, 42.71736217161768, 43.553327163668314, 44.599855004437615, 47.49352902883152, 48.410746888573996, 49.4164674757167, 50.51943981160886, 51.11036091241492, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014, 52.068393894379014], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.01563791277701115, 0.015726186651782444, 0.015825789871252705, 0.015918468231964387, 0.017156381587269124, 0.017238188164517713, 0.017319060477945014, 0.017399921770869374, 0.01750940760808676, 0.017576694973393557, 0.017639824019247807, 0.017700195043815467, 0.017729880020010573, 0.01778594479189282, 0.018010256523437924, 0.017623777028929796, 0.017293642886333185, 0.017020227607149524, 0.01680277838356055], 12496.800000000001)
        
        high_output_test = TASOPT.odperf!(ac, W[1], FL, Ldebug) 
        
        # Compare scalar values
        @test isapprox(high_output_test[1], high_outputs_correct[1]; atol=1e-6)
        @test isapprox(high_output_test[2], high_outputs_correct[2]; atol=1e-6)

        # Compare vector values
        for i in 1:length(high_outputs_correct[3:end])
            @test isapprox(high_output_test[i+2], high_outputs_correct[i+2]; atol=1e-6)
        end
        
        nom_output_test  = TASOPT.odperf!(ac, W[2], FL, Ldebug) 
        # Compare scalar values
        @test isapprox(nom_output_test[1], nom_outputs_correct[1]; atol=1e-6)
        @test isapprox(nom_output_test[2], nom_outputs_correct[2]; atol=1e-6)

        # Compare vector values
        for i in 1:length(nom_outputs_correct[3:end])
            @test isapprox(nom_output_test[i+2], nom_outputs_correct[i+2]; atol=1e-6)
        end

        low_outputs_test = TASOPT.odperf!(ac, W[3], FL, Ldebug) 
        # Compare scalar values
        @test isapprox(low_outputs_test[1], low_outputs_correct[1]; atol=1e-6)
        @test isapprox(low_outputs_test[2], low_outputs_correct[2]; atol=1e-6)

        # Compare vector values
        for i in 1:length(low_outputs_correct[3:end])
            @test isapprox(low_outputs_test[i+2], low_outputs_correct[i+2]; atol=1e-6)
        end

    end


    @testset "LTO" begin

        file_LTO =joinpath(TASOPT.__TASOPTroot__, "../test/LTO_test.LTO")
        file_LTO_extra_pts =joinpath(TASOPT.__TASOPTroot__, "../test/LTO_extra_pts_test.LTO")

        open("B738__.LTO", "w") do f
            TASOPT.output_LTO_perf("B738__", ac; fileout = f, method = "quartic")
        end

        content = read(file_LTO, String)
        content = replace(content, "\r\n"=> "\n") # Convert \r\n to \n

        test_file_LTO = read("B738__.LTO", String)

        # Correct date:
        test_file_LTO = replace(test_file_LTO, r"[A-Z][a-z]{2}\s+\d{1,2}\s+20\d{2}" => "Feb 28 2025")
        @test content == test_file_LTO
        rm("B738__.LTO")
        
        open("B738__extra_pts.LTO", "w") do f
            TASOPT.output_LTO_perf("B738__extra_pts", ac; fileout = f, extra_points = true,method = "quartic")
        end

        content = read(file_LTO_extra_pts, String)
        content = replace(content, "\r\n"=> "\n") # Convert \r\n to \n

        test_file_LTO_extrapts = read("B738__extra_pts.LTO", String)
        # Correct date:
        test_file_LTO_extrapts = replace(test_file_LTO_extrapts, r"[A-Z][a-z]{2}\s+\d{1,2}\s+20\d{2}" => "Feb 28 2025")
        @test content == test_file_LTO_extrapts
        rm("B738__extra_pts.LTO")

    end

    @testset "PTF" begin
        W0high, h3, V0shigh, desTAShigh, ROChigh, mdotfhigh, crzmdotfhigh, crzTAShigh, EGThigh, FFmaxcrzhigh, ROCmaxhigh , Tt4crzhigh, Tt4crzmaxhigh, crzEINOxhigh, clmbEINOxhigh, crzFARhigh, cruisealthigh = TASOPT.odperf!(ac, W[1], FL, Ldebug) 
        W0nom , h2, V0snom , desTASnom, ROCnom , mdotfnom , crzmdotfnom , crzTASnom , EGTnom , FFmaxcrznom , ROCmaxnom  , Tt4crznom , Tt4crzmaxnom , crzEINOxnom , clmbEINOxnom , crzFARnom, cruisealtnom  = TASOPT.odperf!(ac, W[2], FL, Ldebug) 
        W0lo  , h1, V0slo  , desTASlo, ROClo  , mdotflo  , crzmdotflo  , crzTASlo  , EGTlo  , FFmaxcrzlo  , ROCmaxlo   , Tt4crzlo  , Tt4crzmaxlo  , crzEINOxlo  , clmbEINOxlo  , crzFARlo, cruisealtlo   = TASOPT.odperf!(ac, W[3], FL, Ldebug) 
        
        file_PTF_NOX =joinpath(TASOPT.__TASOPTroot__, "../test/PTF_NOX_test.PTF")
        file_PTF =joinpath(TASOPT.__TASOPTroot__, "../test/PTF_test.PTF")
        

        ptf_file_name = "NOX_B738__.PTF" 
        open(ptf_file_name, "w") do f
            TASOPT.output_BADA(f, "B738__", [W0lo, W0nom, W0high], max(cruisealthigh, cruisealtnom, cruisealtlo),
                V0slo./kts_to_mps, desTASlo, hcat(ROClo, ROCnom, ROChigh)', mdotfnom*60,
                hcat(crzmdotflo*60, crzmdotfnom*60, crzmdotfhigh*60)', crzTASlo, FL, Wpaymax; NOx = true, crzNoxEI =hcat(crzEINOxlo,crzEINOxnom,crzEINOxhigh)', ffpminNoxEI=clmbEINOxnom)
        end

        content = read(file_PTF_NOX, String)
        content = replace(content, "\r\n"=> "\n") # Convert \r\n to \n
        NOX_PTF_FILE = read("NOX_B738__.PTF", String)
        NOX_PTF_FILE = replace(NOX_PTF_FILE, r"[A-Z][a-z]{2}\s+\d{1,2}\s+20\d{2}" => "Feb 28 2025")
        @test content == NOX_PTF_FILE
        rm("NOX_B738__.PTF")

                         
        ptf_file_name = "B738__.PTF"              
        open(ptf_file_name, "w") do f
        # open("B738__.PTF", "w") do f
            TASOPT.output_BADA(f, "B738__", [W0lo, W0nom, W0high], max(cruisealthigh, cruisealtnom, cruisealtlo),
            V0slo./kts_to_mps, desTASlo, hcat(ROClo, ROCnom, ROChigh)', mdotfnom*60,
            hcat(crzmdotflo*60, crzmdotfnom*60, crzmdotfhigh*60)', crzTASlo, FL, Wpaymax; NOx = false, crzNoxEI =hcat(crzEINOxlo,crzEINOxnom,crzEINOxhigh)', ffpminNoxEI=clmbEINOxnom)
        end

        content = read(file_PTF, String)
        content = replace(content, "\r\n"=> "\n") # Convert \r\n to \n
        PTF_FILE = read("B738__.PTF", String)
        PTF_FILE = replace(PTF_FILE, r"[A-Z][a-z]{2}\s+\d{1,2}\s+20\d{2}" => "Feb 28 2025")
        @test content == PTF_FILE
        rm("B738__.PTF")

    end 
end